services:
  # Server Service
  server:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: punarnavah-server
    ports:
      - "8080:8080" # Expose server on port 8080
    environment:
      - NODE_ENV=production
      - PORT=8080
      - DATABASE_URL=${DATABASE_URL} # Inject DATABASE_URL from .env file
      - CLIENT_URL=${CLIENT_URL} # Inject CLIENT_URL from .env file
      - JWT_SECRET=${JWT_SECRET} # Inject JWT_SECRET from .env file
    networks:
      - punarnavah-network

  # Client Service
  client:
    build:
      context: ./client
      dockerfile: Dockerfile
    container_name: punarnavah-client
    ports:
      - "5173:5173" # Expose client on port 5173
    environment:
      - VITE_API_URL=http://server:8080 # Use the internal network to access server API
    networks:
      - punarnavah-network

networks:
  punarnavah-network:
    driver: bridge
